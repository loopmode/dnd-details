<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/html5-drop-details.js | my-package API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-html5DropDetails">html5DropDetails</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/html5-drop-details.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import isUrl from &apos;is-url&apos;;

export const imageSrcRegExp = /&lt;img\s.*?src=(?:&apos;|&quot;)([^&apos;&quot;&gt;]+)(?:&apos;|&quot;)/gim;
export const linkHrefRegExp = /&lt;a\s.*?href=(?:&apos;|&quot;)([^&apos;&quot;&gt;]+)(?:&apos;|&quot;)/gim;

/**
 * Retrieves details about dropped content in a drag-drop operation.
 *
 * Expects the `DragEvent` object of a drop event.
 * Returns an object with info, depending of the kind of content that was dragged.
 *
 * - When dragging files from the local filesystem, `&quot;files&quot;` will be the only set property, the other properties will have empty or default values
 * - When dragging content from another browser window, `&quot;files&quot;` will be always empty, but some or all of the other values might be set
 *
 * @param {DragEvent} event - The `ondrop` event object
 * @return {object} details
 * @property {FileList} files - A list of files dragged in from the local filesystem
 * @property {String} html - The HTML code of an element dragged in from another browser window
 * @property {String} text - A text, e.g. the text of a dragged link, or simply dragged text content
 * @property {Array} links - An array of URLs found in links of dropped HTML content.
 * @property {Array} images - An array of image URLs found in `src` attributes of images in dropped HTML content.
 */
export default function html5DropDetails(event) {
    const html = (event.dataTransfer &amp;&amp; event.dataTransfer.getData(&apos;text/html&apos;)) || &apos;&apos;;
    const images = getRegExpMatches(html, imageSrcRegExp) || [];
    let links = getRegExpMatches(html, linkHrefRegExp) || [];
    let text = event.dataTransfer.getData(&apos;Text&apos;) || &apos;&apos;;

    // text is sometimes same as the src for dropped images
    // (with some encoding/escaping differences, normalized via getHtmlText)
    // reset text to null in these cases
    if (text === getHtmlText(images[0]) &amp;&amp; html.substr(0, 4) === &apos;&lt;img&apos;) {
        text = &apos;&apos;;
    }

    // text is sometimes same as the href for dropped links
    // most times, we can get the real text from the html
    if (text === links[0] &amp;&amp; html.substr(0, 2) === &apos;&lt;a&apos;) {
        text = this.getHtmlText(html);
    }

    // many times the text is a URL, even if sometimes no were detected (e.g. drop address bar)
    if (isUrl(text)) {
        if (links.length === 0) {
            links = [text];
        } else if (links.indexOf(text) === -1) {
            links.push(text);
        }
    }

    // always return empty arrays for links and images instead of e.g. null,
    // this way, callsites can safely check for e.g. images.length or images[0]
    return {
        files: (event.dataTransfer &amp;&amp; event.dataTransfer.files) || null,
        html: html || &apos;&apos;,
        text: text || &apos;&apos;,
        links: links,
        images: images
    };
}

function getHtmlText(str) {
    if (!str) return &apos;&apos;;
    const el = document.createElement(&apos;div&apos;);
    el.innerHTML = str;
    return el.innerText.trim();
}

function getRegExpMatches(str, reg, group = 1) {
    const matches = [];
    if (str) {
        let match = reg.exec(str);
        while (match != null) {
            matches.push(match[group]);
            match = reg.exec(str);
        }
    }
    return matches;
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
